// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("CLUSTER_URL")
}

// Product
model Product {
  id                    String   @id @default(auto()) @map("_id") @db.ObjectId
  product_name          String
  sku                   String
  barcodeType           String
  unit                  String
  stock                 Int      @default(0)     
  brandId               String   @db.ObjectId
  categoryId            String   @db.ObjectId
  tax                   String
  sellingPriceTaxType   String
  excTax                Int
  incTax                Int
  margin                Int
  sellingPrice          Int

  brand                 Brand    @relation(fields: [brandId], references: [id])
  category              Category @relation(fields: [categoryId], references: [id])

  purchaseItems         PurchaseItem[] 
  salesItems            SaleItem[]
  purchaseReturnItem    PurchaseReturnItem[]
  saleReturnItem        SalesReturnItem[]
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

//PURCHASE
model Purchase {
  id                 String         @id @default(auto()) @map("_id") @db.ObjectId
  referenceNo        String
  supplierId         String         @db.ObjectId
  purchaseDate       DateTime       @default(now())
  status             purchaseStatus 
  totalAmount        Float
  dueAmount          Float        
  
  supplier           Supplier       @relation(fields: [supplierId], references: [id])
  items              PurchaseItem[]
  payments           PurchasePayment[]

  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
}

//PURCHASE ITEAMS
model PurchaseItem {
  id                    String   @id @default(auto()) @map("_id") @db.ObjectId
  purchaseId            String   @db.ObjectId
  product_name          String
  productId             String   @db.ObjectId
  quantity              Int
  excTax                Float
  incTax                Float
  discount              Float
  subtotal              Float     
  total                 Float     

  product               Product  @relation(fields: [productId], references: [id])
  purchase              Purchase @relation(fields: [purchaseId], references: [id])

  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

enum purchaseStatus {
  Received
  Pending
  Cancelled
}

model PurchaseReturn {
  id                  String       @id @default(auto()) @map("_id") @db.ObjectId
  referenceNo         String
  supplierId          String       @db.ObjectId
  returnDate          DateTime     @default(now())
  totalAmount         Float

  purchaseReturnItem  PurchaseReturnItem[]
  supplier            Supplier       @relation(fields: [supplierId], references: [id])
  
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
}

model PurchaseReturnItem {
  id                    String   @id @default(auto()) @map("_id") @db.ObjectId
  purchaseReturnId      String   @db.ObjectId
  product_name          String
  productId             String   @db.ObjectId
  quantity              Int
  excTax                Float
  subtotal              Float     
  total                 Float     

  product               Product         @relation(fields: [productId], references: [id])
  purchaseReturn        PurchaseReturn  @relation(fields: [purchaseReturnId], references: [id])

  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}



//SALES 

model Sale {
  id                String          @id @default(auto()) @map("_id") @db.ObjectId
  invoiceNo         String
  customerId        String          @db.ObjectId
  salesdate         DateTime        @default(now())
  grandTotal        Float
  dueAmount         Float
  
  customer          Customer        @relation(fields: [customerId], references: [id])
  items             SaleItem[]
  payments          SalesPayment[]

  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
}

model SaleItem {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  saleId       String   @db.ObjectId
  product_name String
  productId    String   @db.ObjectId
  quantity     Int
  excTax       Float
  incTax       Float
  discount     Float
  subtotal     Float
  total        Float

  product      Product  @relation(fields: [productId], references: [id])
  sale         Sale     @relation(fields: [saleId], references: [id])

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model SalesReturn {
  id                String       @id @default(auto()) @map("_id") @db.ObjectId
  invoiceNo         String
  customerId        String       @db.ObjectId
  salesReturnDate   DateTime     @default(now())
  grandTotal        Float

  customer          Customer      @relation(fields: [customerId], references: [id])
  salesReturnItem   SalesReturnItem[]

  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
}

model SalesReturnItem {
  id                    String   @id @default(auto()) @map("_id") @db.ObjectId
  salesReturnId         String   @db.ObjectId
  product_name          String
  productId             String   @db.ObjectId
  quantity              Int
  excTax                Float
  subtotal              Float  
  total                 Float     

  product               Product  @relation(fields: [productId], references: [id])
  salesReturn           SalesReturn  @relation(fields: [salesReturnId], references: [id])

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

enum PaymentMethod {
  Bank
  Cash
}

//PAYMENT
model PurchasePayment {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  amount          Float
  paidOn          DateTime
  paymentMethod   String
  paymentNote     String?
  purchaseId      String   @db.ObjectId

  purchase        Purchase @relation(fields: [purchaseId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model SalesPayment {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  amount          Float
  paidOn          DateTime
  paymentMethod   String
  paymentNote     String?
  salesId         String   @db.ObjectId

  sale            Sale @relation(fields: [salesId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}


// Brand
model Brand {
  id      String    @id @default(auto()) @map("_id") @db.ObjectId
  name    String    @unique
  product Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Category
model Category {
  id       String    @id @default(auto()) @map("_id") @db.ObjectId
  name     String    @unique
  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


// Expense
model Expense {
  id                      String   @id @default(auto()) @map("_id") @db.ObjectId
  title                   String
  description             String?
  amount                  Int
  date                    DateTime
  expenseCategoryId       String @db.ObjectId
  category                ExpenseCategory @relation(fields: [expenseCategoryId], references: [id])

  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model ExpenseCategory {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  name  String @unique
  expenses Expense[]
}


model Supplier {
  id                  String    @id @default(auto()) @map("_id") @db.ObjectId
  SupplierId          String
  name                String    @unique
  email               String    @unique
  phone               String    @unique
  openingBalance      Float     @default(0)
  address             String
  purchaseDue         Float     @default(0)
  purchaseReturnDue   Float     @default(0)

  purchase            Purchase[]
  purchaseReturn      PurchaseReturn[]
  BalancePayment      BalancePayment[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Customer {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  CustomerID     String
  name           String    @unique
  email          String    @unique
  phone          String    @unique
  openingBalance Float     @default(0)
  address        String
  salesDue       Float     @default(0)
  salesReturnDue Float     @default(0)

  sale           Sale[]
  salesReturn    SalesReturn[]
  BalancePayment BalancePayment[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model BalancePayment {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  amount      Float
  paidOn      DateTime @default(now())
  note        String?
  method      String

  customer    Customer? @relation(fields: [customerId], references: [id])
  customerId  String?   @db.ObjectId

  supplier    Supplier? @relation(fields: [supplierId], references: [id])
  supplierId  String?   @db.ObjectId

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


enum PurchaseStatus {
  Received
  Pending
  Cancelled
}

enum PaymentStatus {
  Due
  Paid
  Partial
}

model TaxRates {
  id        String     @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  taxRate   String

  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
}

